<!--
title: 【aws system manager】セッションマネージャーの活用法
tags: aws,ssm,system_manager
id: 
private: false
-->

## セッションマネージャーの概要と利点
awsについて初心者エンジニアに向けて、セッションマネージャーの概要と利点について紹介します。

### セッションマネージャーとは？
aws systems managerは、awsリソースやアプリケーションをエンドユーザーに対して効率的に管理するためのサービスであり、その中のセッションマネージャーは、リモートでec2インスタンスにセキュアなリモートアクセスを提供します。通常、ec2インスタンスにリモートアクセスするためには、sshやrdpなどの手法が用いられますが、セッションマネージャーを使用することで、ec2インスタンスに対してブラウザ上での操作が可能になります。

### セッションマネージャーの利点
セッションマネージャーを活用すると、以下のような利点があります。

#### セキュアなリモートアクセス
セッションマネージャーは、ブラウザ上からのリモートアクセスを提供するため、sshやrdpなどのポートを開放する必要がありません。また、iamロールやポリシーに基づいたアクセス制御が可能であり、セキュリティの向上に役立ちます。

#### トラブルシューティングの簡素化
セッションマネージャーを使用することで、ec2インスタンスに対してリモートアクセスするための事前準備や設定が不要になります。そのため、トラブルシューティング作業が簡素化され、効率的に問題の解決が行えます。

#### コマンド実行とスクリプトの管理
セッションマネージャーは、インスタンスに対してコマンドを実行したり、shellスクリプトやpowershellスクリプトを管理したりすることもできます。これにより、リモートでの作業がより容易になります。

#### ロギングと監査機能
セッションマネージャーは、実行されたコマンドや操作ログを自動的に記録します。これにより、リモート操作のトラッキングやセキュリティ監査が行えます。

### セッションマネージャーのセキュアなリモートアクセス手法
セッションマネージャーを使用してセキュアなリモートアクセスを行う手法について説明します。

#### ステップ1: iamロールの作成
まず、セッションマネージャーを使用するためのiamロールを作成する必要があります。iamロールは、セッションマネージャーに対して必要なアクセス権限を付与するために使用されます。

以下のjsonポリシーを使用して、セッションマネージャーへのアクセスを許可するiamポリシーを作成します。

```
{
    "version": "2012-10-17",
    "statement": [
        {
            "effect": "allow",
            "action": [
                "ssm:startsession",
                "ssm:describeinstanceinformation"
            ],
            "resource": "*"
        }
    ]
}
```

#### ステップ2: インスタンスへのセッションの開始
iamロールを作成した後、aws management consoleにサインインし、systems managerのコンソールに移動します。インスタンスリストから、セッションを開始したいインスタンスを選択します。

インスタンスの詳細ページで、「セッションの開始」ボタンをクリックします。すると、新しいブラウザータブが開き、インスタンスへのセッションが開始されます。

### セッションマネージャーを使用したインスタンスのトラブルシューティング
セッションマネージャーを使用して、インスタンスのトラブルシューティングを行う方法について説明します。

#### ステップ1: インスタンスへのセッションの開始
セッションマネージャーを使用して、インスタンスにリモートアクセスします。先ほど説明した手法に従って、インスタンスへのセッションを開始します。

#### ステップ2: ログの確認
セッションが開始された後、ec2インスタンス上のログを確認することで、トラブルの原因を特定することができます。ログは/var/logディレクトリに保存されています。

たとえば、以下のコマンドを使用して/var/log/syslogファイルの最新の50行を表示することができます。

```
$ tail -n 50 /var/log/syslog
```

#### ステップ3: コマンドの実行
セッションマネージャーを使用して、特定のコマンドをインスタンス上で実行することもできます。たとえば、以下のコマンドを使用して、ディスク使用状況を表示することができます。

```
$ df -h
```

### セッションマネージャーと統合されたコマンド実行とスクリプトの管理
セッションマネージャーを使用して、インスタンスに対してコマンドを実行したり、スクリプトを管理したりする方法について説明します。

#### コマンドの実行
セッションマネージャーを使用して、特定のコマンドをインスタンス上で実行することができます。以下の手順に従って、コマンドの実行を行ってください。

1. セッションマネージャーを使用してインスタンスにセッションを開始します。
2. セッションが開始されたら、ターミナル上で任意のコマンドを入力して実行します。

#### スクリプトの管理
セッションマネージャーを使用して、インスタンス上で実行するスクリプトを管理することもできます。スクリプトは、以下の手順に従って作成、編集、削除することができます。

1. セッションマネージャーを使用してインスタンスにセッションを開始します。
2. セッションが開始されたら、ターミナル上でスクリプトを作成、編集、削除します。

セッションマネージャーは、複数のスクリプトを一括で実行することも可能です。たとえば、以下の手順に従って、myscript.shというスクリプトを実行することができます。

```
$ ssm-session-manager-plugin run-command --document-name "aws-runshellscript" --parameters 'commands=["./myscript.sh"]' --instance-ids "i-12345..."
```

### セッションマネージャーのロギングと監査機能
セッションマネージャーは、実行されたコマンドや操作ログを自動的に記録します。これにより、リモート操作のトラッキングやセキュリティ監査が行えます。

セッションマネージャーのログは、aws cloudtrailで監査および分析することができます。cloudtrailを使用すると、セッションマネージャーを通じて実行されたコマンドや操作が、日付やユーザー、リソースなどのパラメーターで絞り込まれたログとして保存されます。

ログの確認は、以下の手順に従って行うことができます。

1. aws management consoleにサインインし、cloudtrailのコンソールに移動します。
2. ログの詳細を確認する際には、フィルタリングやグループ化などの機能を使用して、必要な情報を取得します。

## まとめ
今回は、aws systems managerのセッションマネージャーの概要と利点について紹介しました。セッションマネージャーを使用することで、セキュアなリモートアクセスが可能になり、トラブルシューティングも簡素化されます。また、コマンド実行やスクリプトの管理、ログの確認といった機能も提供されています。awsに初めて触れるエンジニアにとっても、セッションマネージャーは非常に便利なツールです。是非、活用してみてください。

参考記事:
- [aws systems manager session managerの使用方法](https://dev.classmethod.jp/articles/aws-systems-manager-session-manager-usage/)
- [aws re:invent 2018: [repeat 1] gain operational insights and take action on aws resources with aws systems manager (sid201-r1)](https://www.youtube.com/watch?v=dhzvz5ruebu)

　

## 【AWS System Manager】関連のまとめ
https://hack-note.com/summary/aws-ssm-summary/

　

## オンラインスクールを講師として活用する！
https://hack-note.com/programming-schools/

　

## 0円でプログラミングを学ぶという選択
- [techacademyの無料体験](//af.moshimo.com/af/c/click?a_id=2612475&amp;p_id=1555&amp;pc_id=2816&amp;pl_id=22706&amp;url=https%3a%2f%2ftechacademy.jp%2fhtmlcss-trial%3futm_source%3dmoshimo%26utm_medium%3daffiliate%26utm_campaign%3dtextad)
- [オンラインスクール dmm webcamp pro](//af.moshimo.com/af/c/click?a_id=2612482&amp;p_id=1363&amp;pc_id=2297&amp;pl_id=39999&amp;guid=on)
- [レバテックカレッジ｜大学生向け 無料説明会](//af.moshimo.com/af/c/click?a_id=4071793&p_id=3198&pc_id=7488&pl_id=41848)

